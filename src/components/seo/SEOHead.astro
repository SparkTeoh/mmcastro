---
// Enhanced SEO Head component for MMC Astro
import type { EnhancedContentData } from '../../types/content';
import { 
  generateSEOTitle, 
  generateMetaDescription, 
  generateCanonicalURL,
  generateArticleSchema,
  generateOpenGraphTags,
  generateTwitterCardTags,
  generateRobotsMetaTag
} from '../../utils/seo';

interface Props {
  contentData?: EnhancedContentData;
  title?: string;
  description?: string;
  image?: string;
  noindex?: boolean;
  nofollow?: boolean;
}

const { 
  contentData, 
  title, 
  description, 
  image,
  noindex = false,
  nofollow = false
} = Astro.props;

// Generate SEO data
const seoTitle = contentData ? generateSEOTitle(contentData) : (title || "MMC Financial");
const seoDescription = contentData ? generateMetaDescription(contentData) : (description || "MMC Financial - 马来西亚领先的财务规划与预算管理专家");
const canonicalURL = generateCanonicalURL(Astro.url);
const imageURL = image || "https://mmcfin.com/images/contact/MMCOffice.webp";

// Generate schema markup
const articleSchema = contentData ? generateArticleSchema(contentData, canonicalURL) : null;

// Generate social media tags
const ogTags = contentData ? generateOpenGraphTags(contentData, canonicalURL, imageURL) : null;
const twitterTags = contentData ? generateTwitterCardTags(contentData, canonicalURL, imageURL) : null;

// Generate robots directive
const robotsContent = generateRobotsMetaTag(!noindex, !nofollow, true, true);
---

<!-- Basic Meta Tags -->
<title>{seoTitle}</title>
<meta name="description" content={seoDescription} />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta charset="UTF-8" />

<!-- SEO Meta Tags -->
<meta name="robots" content={robotsContent} />
<meta name="googlebot" content={robotsContent} />
<meta name="bingbot" content={robotsContent} />

<!-- AI Crawler specific meta tags -->
<meta name="GPTBot" content={!noindex ? "index, follow" : "noindex, nofollow"} />
<meta name="ClaudeBot" content={!noindex ? "index, follow" : "noindex, nofollow"} />
<meta name="PerplexityBot" content={!noindex ? "index, follow" : "noindex, nofollow"} />

<!-- Canonical URL -->
<link rel="canonical" href={canonicalURL} />

<!-- Keywords -->
{contentData?.focusKeywords && (
  <meta name="keywords" content={contentData.focusKeywords.join(", ")} />
)}

<!-- Author -->
{contentData?.author && (
  <meta name="author" content={contentData.author} />
)}

<!-- Publication Date -->
{contentData?.pubDate && (
  <meta name="article:published_time" content={contentData.pubDate.toISOString()} />
)}

<!-- Language -->
<meta name="language" content="zh-CN" />
<html lang="zh-CN" />

<!-- Geographic Information -->
<meta name="geo.region" content="MY-14" />
<meta name="geo.placename" content="Kuala Lumpur" />
<meta name="geo.position" content="3.1390;101.6869" />
<meta name="ICBM" content="3.1390, 101.6869" />

<!-- Theme and Brand Colors -->
<meta name="theme-color" content="#024340" />
<meta name="msapplication-TileColor" content="#024340" />

<!-- Open Graph Tags -->
{ogTags && Object.entries(ogTags).map(([property, content]) => (
  <meta property={property} content={content} />
))}

<!-- Twitter Card Tags -->
{twitterTags && Object.entries(twitterTags).map(([name, content]) => (
  <meta name={name} content={content} />
))}

<!-- Structured Data -->
{articleSchema && (
  <script type="application/ld+json" set:html={JSON.stringify(articleSchema)} />
)}

<!-- Favicon and Icons -->
<link rel="icon" type="image/png" sizes="32x32" href="/MMCFavicon.png" />
<link rel="icon" type="image/png" sizes="16x16" href="/MMCFavicon.png" />
<link rel="shortcut icon" type="image/png" href="/MMCFavicon.png" />
<link rel="apple-touch-icon" sizes="180x180" href="/MMCFavicon.png" />
<link rel="manifest" href="/site.webmanifest" />

<!-- Apple Mobile Web App -->
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="default" />
<meta name="apple-mobile-web-app-title" content="MMC Financial" />

<!-- Generator -->
<meta name="generator" content={Astro.generator} />

<!-- Preconnect to external domains for performance -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

<!-- DNS Prefetch for better performance -->
<link rel="dns-prefetch" href="//www.google-analytics.com" />
<link rel="dns-prefetch" href="//fonts.googleapis.com" />
<link rel="dns-prefetch" href="//fonts.gstatic.com" />

<!-- Additional GEO optimization meta tags -->
{contentData?.schemaType && (
  <meta name="ai-content-type" content={contentData.schemaType} />
)}

{contentData?.focusKeywords && (
  <meta name="target-queries" content={contentData.focusKeywords.join(", ")} />
)}

<!-- Content freshness indicator -->
{contentData?.pubDate && (
  <meta name="content-freshness" content={contentData.pubDate.toISOString()} />
)}

<!-- E-E-A-T signals -->
{contentData?.authorCredentials && (
  <meta name="author-credentials" content={contentData.authorCredentials.join(", ")} />
)}

<!-- Content category for AI understanding -->
{contentData?.type && (
  <meta name="content-category" content={contentData.type} />
)}

<!-- Reading time estimate (for user experience) -->
{contentData?.summary && (
  <meta name="reading-time" content={Math.ceil(contentData.summary.split(' ').length / 200) + " minutes"} />
)}